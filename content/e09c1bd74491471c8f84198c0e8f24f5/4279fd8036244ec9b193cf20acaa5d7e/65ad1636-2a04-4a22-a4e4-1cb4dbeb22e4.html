<div class="eg-content-editor" data-type="imageEditorOneColumn"><div class="column">
  <div class="cropped-image" style="position:relative;overflow: hidden;padding-top: 59.65909090909091%">
    <img style="position: absolute; top: 50%;left: 50%;transform: translate(-50%, -50%);max-width: 100%; max-height: 100%;" src="https://files-storage.easygenerator.com/image/7e6887b4-6af3-44d8-9ae7-c0517c5419d5.png" alt="" data-src="https://files-storage.easygenerator.com/image/937423ee-6088-4795-8ab7-0b240fdf9360.png" data-init="{&quot;w&quot;:880,&quot;h&quot;:525,&quot;y&quot;:0,&quot;x&quot;:-40.93279069767436,&quot;defaultScale&quot;:1.5527906976744188,&quot;scale&quot;:0.7763953488372094}">
  </div>
  <div class="row" data-content-type="TextEditor"><p style="text-align: center;">Figure 8.6: Operational flow of temporal keys<em><br></em></p><ul><li style="text-align: left;"><em>AP sends an ANonce to the client, which uses it to construct the pairwise transient key (PTK).</em></li><li><em>The client responds with its own Nonce value (SNonce) to the AP, together with an MIC.</em></li><li><em>The AP sends the group temporal key (GTK) and a sequence number, together with another MIC, which is used in the next broadcast frames.</em></li><li><em>The client confirms that the temporal keys are installed.</em></li></ul><p style="text-align:justify;"><strong>How WPA Works</strong></p><ul><li style="text-align: justify;">A TK, transmit address, and TKIP sequence counter (TSC) are used as input to the RC4 algorithm to generate a keystream.</li><li style="text-align: justify;"><em>The IV or TK sequence, transmit address or MAC destination address, and TK are combined with a hash function or mixing function to generate a 128-bit and 104-bit key.</em></li><li style="text-align: justify;"><em>This key is then combined with RC4 to produce the keystream, which should be of the same length as the original message.</em></li><li style="text-align: justify;">The MAC service data unit (MSDU) and message integrity check (MIC) are combined using the Michael algorithm.</li><li style="text-align: justify;">The combination of MSDU and MIC is fragmented to generate the MAC protocol data unit (MPDU).</li><li style="text-align: justify;">A 32-bit ICV is calculated for the MPDU.</li><li style="text-align: justify;">The combination of MPDU and ICV is bitwise XORed with the keystream to produce the encrypted data.</li><li style="text-align: justify;">The IV is added to the encrypted data to generate the MAC frame.</li></ul></div>
</div></div>